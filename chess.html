<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Chess - IWM Brokerage</title>
  <style>
    :root {
      --bg: #091954;
      --gold: #AB9C59;
      --light: #f0d9b5;
      --dark: #b58863;
      --text: #ffffff;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Libre Baskerville', serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }

    h1 {
      font-size: 2.4rem;
      margin: 15px 0 8px;
      color: var(--gold);
      text-shadow: 0 2px 10px rgba(171,156,89,0.4);
    }

    p {
      font-size: 1.1rem;
      margin-bottom: 15px;
      opacity: 0.9;
    }

    .captured {
      font-size: 32px;
      min-height: 50px;
      padding: 8px;
      text-align: center;
    }

    #white-captured { order: 1; }
    #board-container { order: 2; }
    #black-captured { order: 3; }

    #board {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      width: 96vw;
      max-width: 460px;
      aspect-ratio: 1 / 1;
      margin: 10px auto;
      border: 10px solid var(--gold);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.6),
                  inset 0 0 20px rgba(171,156,89,0.3);
    }

    .square {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10vw;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      transition: background 0.2s;
    }

    @media (min-width: 500px) {
      .square { font-size: 48px; }
    }

    .light { background: var(--light); }
    .dark  { background: var(--dark); }

    .selected {
      background: #ffeb3b !important;
      box-shadow: inset 0 0 15px #000;
    }

    .possible {
      background: #4caf50 !important;
      opacity: 0.8;
    }

    #status {
      font-size: 1.4rem;
      font-weight: bold;
      margin: 20px 0;
      padding: 12px 20px;
      background: rgba(171,156,89,0.15);
      border-radius: 12px;
      min-width: 280px;
    }

    button {
      margin-top: 10px;
      padding: 14px 32px;
      font-family: 'Libre Baskerville', serif;
      font-size: 1.3rem;
      font-weight: bold;
      background: linear-gradient(135deg, #AB9C59, #8B7D47);
      color: #091954;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 6px 15px rgba(171,156,89,0.4);
      transition: all 0.3s;
    }

    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(171,156,89,0.6);
    }

    button:active {
      transform: translateY(0);
    }
  </style>
</head>
<body>

  <h1>Chess</h1>
  <p>Tap a piece â†’ tap a square</p>

  <div class="captured" id="white-captured"></div>
  <div id="board"></div>
  <div class="captured" id="black-captured"></div>
  <div id="status">White to move</div>
  <button onclick="resetGame()">New Game</button>

  <script>
    const pieces = {
      'K': 'White King', 'Q': 'White Queen', 'R': 'White Rook', 'B': 'White Bishop', 'N': 'White Knight', 'P': 'White Pawn',
      'k': 'Black King', 'q': 'Black Queen', 'r': 'Black Rook', 'b': 'Black Bishop', 'n': 'Black Knight', 'p': 'Black Pawn'
    };

    function createPiece(type) {
      return { type: type, kills: 0 };
    }

    let boardState = [
      ['r','n','b','q','k','b','n','r'].map(createPiece),
      ['p','p','p','p','p','p','p','p'].map(createPiece),
      [null,null,null,null,null,null,null,null],
      [null,null,null,null,null,null,null,null],
      [null,null,null,null,null,null,null,null],
      [null,null,null,null,null,null,null,null],
      ['P','P','P','P','P','P','P','P'].map(createPiece),
      ['R','N','B','Q','K','B','N','R'].map(createPiece)
    ];

    let selected = null;
    let turn = 'w';
    let whiteCaptured = [];
    let blackCaptured = [];

    const board = document.getElementById('board');

    function renderBoard() {
      board.innerHTML = '';
      for (let row = 0; row < 8; row++) {
        for (let col = 0; col < 8; col++) {
          const square = document.createElement('div');
          square.className = `square ${(row + col) % 2 === 0 ? 'light' : 'dark'}`;
          square.dataset.row = row;
          square.dataset.col = col;

          const p = boardState[row][col];
          if (p) {
            const symbol = pieces[p.type];
            if (p.kills > 0) {
              square.innerHTML = symbol + `<sup style="color:red;font-size:0.4em;vertical-align:super;">${p.kills}</sup>`;
            } else {
              square.innerHTML = symbol;
            }
          }
          square.addEventListener('click', onSquareClick);
          board.appendChild(square);
        }
      }
    }

    function onSquareClick(e) {
      const row = +e.currentTarget.dataset.row;
      const col = +e.currentTarget.dataset.col;
      const piece = boardState[row][col];

      if (selected) {
        if (isLegalMove(selected.row, selected.col, row, col)) {
          const captured = boardState[row][col];
          const moving = boardState[selected.row][selected.col];

          if (captured) {
            moving.kills += 1;
            (turn === 'w' ? blackCaptured : whiteCaptured).push(captured.type);
          }

          boardState[row][col] = moving;
          boardState[selected.row][selected.col] = null;
          turn = turn === 'w' ? 'b' : 'w';
          selected = null;
          clearHighlights();
          renderBoard();
          updateCapturedDisplay();
          updateStatus();
        } else {
          selected = null;
          clearHighlights();
        }
      } else if (piece && ((turn === 'w' && piece.type === piece.type.toUpperCase()) ||
                            (turn === 'b' && piece.type === piece.type.toLowerCase()))) {
        selected = { row, col };
        highlightSquare(row, col, 'selected');
      }
    }

    function isLegalMove(fr, fc, tr, tc) {
      const p = boardState[fr][fc];
      if (!p) return false;
      const target = boardState[tr][tc];
      const isWhite = p.type === p.type.toUpperCase();
      const type = p.type.toLowerCase();

      if (target && ((isWhite && target.type === target.type.toUpperCase()) ||
                     (!isWhite && target.type === target.type.toLowerCase()))) return false;

      const rd = tr - fr;
      const cd = tc - fc;
      const ar = Math.abs(rd);
      const ac = Math.abs(cd);

      const clearPath = () => {
        const rs = rd === 0 ? 0 : rd/ar;
        const cs = cd === 0 ? 0 : cd/ac;
        let r = fr + rs;
        let c = fc + cs;
        while (r !== tr || c !== tc) {
          if (boardState[r][c]) return false;
          r += rs; c += cs;
        }
        return true;
      };

      if (type === 'p') {
        const dir = isWhite ? -1 : 1;
        if (cd === 0 && !target && tr === fr + dir) return true;
        if (cd === 0 && !target && tr === fr + 2*dir && ((isWhite && fr===6) || (!isWhite && fr===1)) && !boardState[fr+dir][fc]) return true;
        if (ac === 1 && tr === fr + dir && target) return true;
        return false;
      }
      if (type === 'r') return (rd===0 || cd===0) && clearPath();
      if (type === 'b') return ar===ac && clearPath();
      if (type === 'q') return (rd===0 || cd===0 || ar===ac) && clearPath();
      if (type === 'n') return (ar===2 && ac===1) || (ar===1 && ac===2);
      if (type === 'k') return ar <=1 && ac <=1;

      return false;
    }

    function highlightSquare(r, c, cls) {
      board.children[r*8 + c].classList.add(cls);
    }

    function clearHighlights() {
      [...board.children].forEach(sq => sq.classList.remove('selected', 'possible'));
    }

    function updateCapturedDisplay() {
      document.getElementById('white-captured').innerHTML = whiteCaptured.map(t => pieces[t.toUpperCase()]).join(' ');
      document.getElementById('black-captured').innerHTML = blackCaptured.map(t => pieces[t]).join(' ');
    }

    function updateStatus() {
      document.getElementById('status').textContent = (turn === 'w' ? 'White' : 'Black') + ' to move';
    }

    function resetGame() {
      boardState = [
        ['r','n','b','q','k','b','n','r'].map(createPiece),
        ['p','p','p','p','p','p','p','p'].map(createPiece),
        [null,null,null,null,null,null,null,null],
        [null,null,null,null,null,null,null,null],
        [null,null,null,null,null,null,null,null],
        [null,null,null,null,null,null,null,null],
        ['P','P','P','P','P','P','P','P'].map(createPiece),
        ['R','N','B','Q','K','B','N','R'].map(createPiece)
      ];
      selected = null;
      turn = 'w';
      whiteCaptured = [];
      blackCaptured = [];
      clearHighlights();
      renderBoard();
      updateCapturedDisplay();
      updateStatus();
    }

    // Start
    renderBoard();
    updateStatus();
  </script>
</body>
</html>
