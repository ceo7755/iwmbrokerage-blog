<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Chess Board - Play Now</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #222;
      color: #fff;
      text-align: center;
      margin: 0;
      padding: 15px 10px;
      min-height: 100vh;
      touch-action: manipulation; /* Better touch response */
    }
    h1 { 
      margin: 0 0 8px 0; 
      font-size: 2.2rem;
    }
    p { 
      margin: 0 0 15px 0; 
      font-size: 1.1rem;
    }

    /* Captured pieces - bigger on mobile */
    #white-captured, #black-captured {
      font-size: 36px;
      min-height: 56px;
      padding: 8px 0;
      word-break: break-all;
      line-height: 1.2;
    }

    /* Board container - responsive with max size */
    #board {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      width: 96vw;
      max-width: 460px;
      height: 96vw;
      max-height: 460px;
      margin: 15px auto;
      border: 10px solid #8B4513;
      border-radius: 8px;
      box-shadow: 0 6px 25px rgba(0,0,0,0.6);
      aspect-ratio: 1 / 1;
      overflow: hidden;
    }

    .square {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10.5vw;        /* Scales perfectly with board size */
      cursor: pointer;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    /* Desktop: cap font size so pieces don't overflow */
    @media (min-width: 500px) {
      .square { font-size: 46px; }
    }

    .light { background: #f0d9b5; }
    .dark { background: #b58863; }
    .selected { background: #ffeb3b !important; }
    .possible { background: #4caf50 !important; opacity: 0.7; }

    #status { 
      font-size: 1.3rem; 
      margin: 18px 0; 
      font-weight: bold;
    }

    button {
      padding: 14px 28px;
      margin: 10px 5px;
      background: #4caf50;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1.1rem;
      font-weight: bold;
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
    }
    button:hover { background: #45a049; }
  </style>
</head>
<body>
  <h1>Chess Board</h1>
  <p>Tap a piece, then tap a square to move. Legal moves only.</p>

  <div id="white-captured"></div>
  <div id="board"></div>
  <div id="black-captured"></div>
  <div id="status">White to move</div>

  <button onclick="resetGame()">New Game</button>

  <script>
    // === YOUR EXACT SAME LOGIC (unchanged) ===
    const pieces = {
      'K': 'K', 'Q': 'Q', 'R': 'R', 'B': 'B', 'N': 'N', 'P': 'P',
      'k': 'k', 'q': 'q', 'r': 'r', 'b': 'b', 'n': 'n', 'p': 'p'
    };

    function createPiece(type) {
      return { type: type, kills: 0 };
    }

    let boardState = [
      ['r','n','b','q','k','b','n','r'].map(t => createPiece(t)),
      ['p','p','p','p','p','p','p','p'].map(t => createPiece(t)),
      [null,null,null,null,null,null,null,null],
      [null,null,null,null,null,null,null,null],
      [null,null,null,null,null,null,null,null],
      [null,null,null,null,null,null,null,null],
      ['P','P','P','P','P','P','P','P'].map(t => createPiece(t)),
      ['R','N','B','Q','K','B','N','R'].map(t => createPiece(t))
    ];

    let selected = null;
    let turn = 'w';
    let whiteCaptured = [];
    let blackCaptured = [];

    const board = document.getElementById('board');

    function renderBoard() {
      board.innerHTML = '';
      for (let row = 0; row < 8; row++) {
        for (let col = 0; col < 8; col++) {
          const square = document.createElement('div');
          square.className = `square ${(row + col) % 2 === 0 ? 'light' : 'dark'}`;
          square.dataset.row = row;
          square.dataset.col = col;

          const pieceObj = boardState[row][col];
          if (pieceObj) {
            const symbol = pieces[pieceObj.type];
            if (pieceObj.kills > 0) {
              square.innerHTML = symbol + `<sup style="color:red;font-size:18px;font-weight:bold;">${pieceObj.kills}</sup>`;
            } else {
              square.innerHTML = symbol;
            }
          }
          square.addEventListener('click', onSquareClick);
          board.appendChild(square);
        }
      }
    }

    function onSquareClick(e) {
      const row = parseInt(e.currentTarget.dataset.row);
      const col = parseInt(e.currentTarget.dataset.col);
      const piece = boardState[row][col];

      if (selected) {
        if (isLegalMove(selected.row, selected.col, row, col)) {
          const captured = boardState[row][col];
          const movingPiece = boardState[selected.row][selected.col];

          if (captured) {
            movingPiece.kills += 1;
            if (turn === 'w') blackCaptured.push(captured.type);
            else whiteCaptured.push(captured.type);
          }

          boardState[row][col] = movingPiece;
          boardState[selected.row][selected.col] = null;

          turn = turn === 'w' ? 'b' : 'w';
          selected = null;
          clearHighlights();
          renderBoard();
          updateCapturedDisplay();
          updateStatus();
        } else {
          selected = null;
          clearHighlights();
        }
      } else if (piece && ((turn === 'w' && piece.type === piece.type.toUpperCase()) || (turn === 'b' && piece.type === piece.type.toLowerCase()))) {
        selected = { row, col };
        highlightSquare(row, col, 'selected');
      }
    }

    function isLegalMove(fromRow, fromCol, toRow, toCol) {
      const piece = boardState[fromRow][fromCol];
      const target = boardState[toRow][toCol];
      if (!piece) return false;

      const isWhite = piece.type === piece.type.toUpperCase();
      const pieceType = piece.type.toLowerCase();

      if (target && ((isWhite && target.type === target.type.toUpperCase()) || (!isWhite && target.type === target.type.toLowerCase()))) {
        return false;
      }

      const rowDiff = toRow - fromRow;
      const colDiff = toCol - fromCol;
      const absRow = Math.abs(rowDiff);
      const absCol = Math.abs(colDiff);

      function isPathClear() {
        const rowStep = rowDiff === 0 ? 0 : rowDiff / absRow;
        const colStep = colDiff === 0 ? 0 : colDiff / absCol;
        let r = fromRow + rowStep;
        let c = fromCol + colStep;
        while (r !== toRow || c !== toCol) {
          if (boardState[Math.round(r)][Math.round(c)] !== null) return false;
          r += rowStep;
          c += colStep;
        }
        return true;
      }

      if (pieceType === 'p') {
        const direction = isWhite ? -1 : 1;
        const forwardOne = fromRow + direction;
        const forwardTwo = fromRow + 2 * direction;

        if (toCol === fromCol && toRow === forwardOne && !target) return true;
        if (toCol === fromCol && toRow === forwardTwo && !target && ((isWhite && fromRow === 6) || (!isWhite && fromRow === 1)) && !boardState[forwardOne][fromCol]) return true;
        if (Math.abs(toCol - fromCol) === 1 && toRow === forwardOne && target) return true;
        return false;
      }

      if (pieceType === 'r') return (rowDiff === 0 || colDiff === 0) && isPathClear();
      if (pieceType === 'b') return absRow === absCol && isPathClear();
      if (pieceType === 'q') return (rowDiff === 0 || colDiff === 0 || absRow === absCol) && isPathClear();
      if (pieceType === 'n') return (absRow === 2 && absCol === 1) || (absRow === 1 && absCol === 2);
      if (pieceType === 'k') return absRow <= 1 && absCol <= 1;

      return false;
    }

    function highlightSquare(row, col, className) {
      board.children[row * 8 + col].classList.add(className);
    }

    function clearHighlights() {
      document.querySelectorAll('.square').forEach(s => s.classList.remove('selected', 'possible'));
    }

    function updateCapturedDisplay() {
      document.getElementById('white-captured').innerHTML = whiteCaptured.map(p => pieces[p.toUpperCase()] || p).join(' ');
      document.getElementById('black-captured').innerHTML = blackCaptured.map(p => pieces[p] || p).join(' ');
    }

    function updateStatus() {
      document.getElementById('status').textContent = (turn === 'w' ? 'White' : 'Black') + ' to move';
    }

    function resetGame() {
      boardState = [
        ['r','n','b','q','k','b','n','r'].map(t => createPiece(t)),
        ['p','p','p','p','p','p','p','p'].map(t => createPiece(t)),
        [null,null,null,null,null,null,null,null],
        [null,null,null,null,null,null,null,null],
        [null,null,null,null,null,null,null,null],
        [null,null,null,null,null,null,null,null],
        ['P','P','P','P','P','P','P','P'].map(t => createPiece(t)),
        ['R','N','B','Q','K','B','N','R'].map(t => createPiece(t))
      ];
      selected = null;
      turn = 'w';
      whiteCaptured = [];
      blackCaptured = [];
      clearHighlights();
      updateStatus();
      renderBoard();
      updateCapturedDisplay();
    }

    renderBoard();
    updateStatus();
    updateCapturedDisplay();
  </script>
</body>
</html>
